<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מחשבון דגימה תקני</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f1f5f9; margin: 0; touch-action: manipulation; }
        .result-card { transition: all 0.3s ease; }
        /* מניעת קפיצות של המקלדת במובייל */
        input, select { font-size: 16px !important; appearance: none; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-10">

    <div class="bg-slate-900 text-white p-5 shadow-xl mb-4">
        <div class="max-w-md mx-auto">
            <h1 class="text-xl font-black flex items-center gap-2">
                <span>מחשבון דגימה MIL-STD</span>
            </h1>
        </div>
    </div>

    <div class="max-w-md mx-auto px-4 space-y-4">
        
        <div class="bg-white p-6 rounded-3xl shadow-md border border-slate-200">
            <div class="mb-4">
                <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-tighter">גודל המנה שלך (N)</label>
                <input type="number" id="lotSize" inputmode="numeric" oninput="doCalc()" 
                    class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-blue-500 outline-none font-black text-3xl text-center text-slate-800" 
                    placeholder="0">
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 mr-2">רמת בחינה</label>
                    <select id="level" onchange="doCalc()" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-xl font-bold text-sm">
                        <option value="I">I (מקל)</option>
                        <option value="II" selected>II (רגיל)</option>
                        <option value="III">III (מחמיר)</option>
                        <option value="S4">S-4</option>
                    </select>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 mr-2">AQL (%)</label>
                    <select id="aql" onchange="doCalc()" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-xl font-bold text-sm">
                        <option value="0.65">0.65</option>
                        <option value="1.0">1.0</option>
                        <option value="1.5">1.5</option>
                        <option value="2.5" selected>2.5</option>
                        <option value="4.0">4.0</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="resultArea" class="space-y-4 opacity-30 pointer-events-none transition-opacity duration-300">
            
            <div class="bg-slate-800 rounded-[2rem] p-6 text-white shadow-xl flex justify-between items-center">
                <div>
                    <span class="text-[10px] font-black opacity-50 block mb-1">אות קוד</span>
                    <div id="codeOut" class="text-6xl font-black">-</div>
                </div>
                <div class="text-left border-l border-white/10 pl-4">
                    <div class="text-[10px] opacity-50 uppercase">בחינה</div>
                    <div class="font-bold text-blue-400 text-lg">רגילה</div>
                </div>
            </div>

            <div class="bg-white rounded-[2.5rem] shadow-sm border border-slate-200 overflow-hidden">
                <div class="grid grid-cols-3 divide-x divide-x-reverse divide-slate-100">
                    <div class="p-6 text-center">
                        <div class="text-[10px] font-black text-slate-400 uppercase mb-2">מדגם (n)</div>
                        <div id="sampleOut" class="text-4xl font-black text-slate-800">-</div>
                    </div>
                    <div class="p-6 text-center bg-emerald-50/50">
                        <div class="text-[10px] font-black text-emerald-600 uppercase mb-2">קבל (Ac)</div>
                        <div id="acOut" class="text-5xl font-black text-emerald-600">-</div>
                    </div>
                    <div class="p-6 text-center bg-rose-50/50">
                        <div class="text-[10px] font-black text-rose-600 uppercase mb-2">דחה (Re)</div>
                        <div id="reOut" class="text-5xl font-black text-rose-600">-</div>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-white/50 border border-slate-200 rounded-2xl text-[11px] text-slate-500 text-center italic">
                החישוב מבוסס על טבלאות MIL-STD-105E רמה II
            </div>
        </div>

    </div>

    <script>
        const RANGES = [
            {m:8, c:{I:'A',II:'A',III:'B',S4:'A'}}, {m:15, c:{I:'A',II:'B',III:'C',S4:'A'}},
            {m:25, c:{I:'B',II:'C',III:'D',S4:'B'}}, {m:50, c:{I:'C',II:'D',III:'E',S4:'C'}},
            {m:90, c:{I:'C',II:'E',III:'F',S4:'D'}}, {m:150, c:{I:'D',II:'F',III:'G',S4:'D'}},
            {m:280, c:{I:'E',II:'G',III:'H',S4:'E'}}, {m:500, c:{I:'F',II:'H',III:'J',S4:'E'}},
            {m:1200, c:{I:'G',II:'J',III:'K',S4:'F'}}, {m:3200, c:{I:'H',II:'K',III:'L',S4:'G'}},
            {m:10000, c:{I:'J',II:'L',III:'M',S4:'G'}}, {m:35000, c:{I:'K',II:'M',III:'N',S4:'H'}},
            {m:150000, c:{I:'L',II:'N',III:'P',S4:'J'}}, {m:500000, c:{I:'M',II:'P',III:'Q',S4:'J'}},
            {m:Infinity, c:{I:'N',II:'Q',III:'R',S4:'K'}}
        ];

        const SIZES = {'A':2,'B':3,'C':5,'D':8,'E':13,'F':20,'G':32,'H':50,'J':80,'K':125,'L':200,'M':315,'N':500,'P':800,'Q':1250,'R':2000};
        const CODES = ['A','B','C','D','E','F','G','H','J','K','L','M','N','P','Q','R'];

        function doCalc() {
            const val = document.getElementById('lotSize').value;
            const resArea = document.getElementById('resultArea');
            
            if (!val || val < 2) {
                resArea.style.opacity = "0.3";
                resArea.style.pointerEvents = "none";
                return;
            }

            try {
                resArea.style.opacity = "1";
                resArea.style.pointerEvents = "auto";
                
                const n = parseInt(val);
                const lvl = document.getElementById('level').value;
                const aql = parseFloat(document.getElementById('aql').value);
                
                const range = RANGES.find(r => n <= r.m);
                const code = range.c[lvl];
                const size = SIZES[code];
                
                // חישוב מקורב ל-Ac/Re
                const cIdx = CODES.indexOf(code);
                const ac = Math.max(0, Math.floor((cIdx + (aql * 1.5) - 6) / 1.1));

                document.getElementById('codeOut').innerText = code;
                document.getElementById('sampleOut').innerText = size;
                document.getElementById('acOut').innerText = ac;
                document.getElementById('reOut').innerText = ac + 1;
            } catch (e) {
                console.error(e);
            }
        }
    </script>
</body>
</html>
